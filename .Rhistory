B08406_015M,
B08406_016E,
B08406_016M,
B08406_017E,
B08406_017M,
key = variable,
value = value
) %>%
mutate(metric = factor(stringr::str_sub(variable,-1,-1)),
variable = factor(stringr::str_sub(variable, 1,-2))) %>%
spread(key = metric, value = value) %>%
mutate(E = as.numeric(E),
M = as.numeric(M))  %>%
mutate(lower95CI = E - (1.96 / 1.645 * M),
upper95CI = E + (1.96 / 1.645 * M)) %>%
left_join(xwk) %>%
group_by(name, state, county, varName) %>%
summarize(
estimate = sum(E, na.rm = T),
lower95CI = sum(lower95CI, na.rm = T),
upper95CI = sum(upper95CI, na.rm = T)
)
return(CNTYtravel)
}
DaneTravel <- getCountyMeansTravel(state = 55,county = 025)
View(Danetravel)
View(DaneTravel)
View(Danetravel)
View(DaneTravel)
library(jsonlite)
library(tidyverse)
state = "55"
county = "025"
getCountyMeansTravel <- function(state, county) {
varString <-
"B08301_001E,B08301_001M,B08301_002E,B08301_002M,B08301_010E,B08301_010M,B08301_016E,B08301_016M,B08301_017E,B08301_017M,B08301_018E,B08301_018M,B08301_019E,B08301_019M,B08301_020E,B08301_020M,B08301_021E,B08301_021M"
# https://api.census.gov/data/2015/acs5?get=NAME,B01001_001E&for=county:013&in=state:02
ACScommute <-
as.data.frame(fromJSON(
paste0(
"https://api.census.gov/data/2015/acs5?get=NAME,",
varString,
"&for=county:",
county,
"&in=state:",
state,
"&key=f78d6b6c18608edc379b5a06c55407ceb45e7038"
)
))
ACScommute <- ACScommute[-1,]
colnames(ACScommute) <-
c(
"name",
"B08301_001E",
"B08301_001M",
"B08301_002E",
"B08301_002M",
"B08301_010E",
"B08301_010M",
"B08301_016E",
"B08301_016M",
"B08301_017E",
"B08301_017M",
"B08301_018E",
"B08301_018M",
"B08301_019E",
"B08301_019M",
"B08301_020E",
"B08301_020M",
"B08301_021E",
"B08301_021M",
"state",
"county"
)
xwk <-
data.frame(
variable = c(
"B08301_001",
"B08301_002",
"B08301_010",
"B08301_016",
"B08301_017",
"B08301_018",
"B08301_019",
"B08301_020",
"B08301_021"
),
varName = c(
"workers",
"drive",
"transit",
"other",
"drive",
"bicycle",
"walk",
"other",
"other"
)
)
CNTYtravel <-
ACScommute %>% gather(
B08301_001E,
B08301_001M,
B08301_002E,
B08301_002M,
B08301_010E,
B08301_010M,
B08301_016E,
B08301_016M,
B08301_017E,
B08301_017M,
B08301_018E,
B08301_018M,
B08301_019E,
B08301_019M,
B08301_020E,
B08301_020M,
B08301_021E,
B08301_021M,
key = variable,
value = value
) %>%
mutate(metric = factor(stringr::str_sub(variable,-1,-1)),
variable = factor(stringr::str_sub(variable, 1,-2))) %>%
spread(key = metric, value = value) %>%
mutate(E = as.numeric(E),
M = as.numeric(M))  %>%
mutate(lower95CI = E - (1.96 / 1.645 * M),
upper95CI = E + (1.96 / 1.645 * M)) %>%
left_join(xwk) %>%
group_by(name, state, county, varName) %>%
summarize(
estimate = sum(E, na.rm = T),
lower95CI = sum(lower95CI, na.rm = T),
upper95CI = sum(upper95CI, na.rm = T)
)
return(CNTYtravel)
}
DaneTravel <- getCountyMeansTravel(state = 55,county = 025)
library(jsonlite)
library(tidyverse)
state = "55"
county = "025"
getCountyMeansTravelBySex <- function(state, county) {
varStringTOTAL <-
"B08406_001E,B08406_001M,B08406_002E,B08406_002M,B08406_008E,B08406_008M,B08406_014E,B08406_014M,B08406_015E,B08406_015M,B08406_016E,B08406_016M,B08406_017E,B08406_017M"
varStringMALE <-
"B08406_018E,B08406_018M,B08406_019E,B08406_019M,B08406_025E,B08406_025M,B08406_031E,B08406_031M,B08406_032E,B08406_032M,B08406_033E,B08406_033M,B08406_034E,B08406_034M"
varStringFEMALE <-
"B08406_035E,B08406_035M,B08406_036E,B08406_036M,B08406_042E,B08406_042M,B08406_048E,B08406_048M,B08406_049E,B08406_049M,B08406_050E,B08406_050M,B08406_051E,B08406_051M"
# https://api.census.gov/data/2015/acs5?get=NAME,B01001_001E&for=county:013&in=state:02
ACScommute <-
as.data.frame(fromJSON(
paste0(
"https://api.census.gov/data/2015/acs5?get=NAME,",
varStringTOTAL,
"&for=county:",
county,
"&in=state:",
state,
"&key=f78d6b6c18608edc379b5a06c55407ceb45e7038"
)
))
ACScommute <- ACScommute[-1, ]
colnames(ACScommute) <-
c(
"name",
"B08406_001E",
"B08406_001M",
"B08406_002E",
"B08406_002M",
"B08406_008E",
"B08406_008M",
"B08406_014E",
"B08406_014M",
"B08406_015E",
"B08406_015M",
"B08406_016E",
"B08406_016M",
"B08406_017E",
"B08406_017M",
"state",
"county"
)
xwk <-
data.frame(
variable = c(
"B08406_001",
"B08406_002",
"B08406_008",
"B08406_014",
"B08406_015",
"B08406_016",
"B08406_017"
),
varName = c(
"workers",
"drive",
"transit",
"bicycle",
"walk",
"other",
"other"
)
)
CNTYtravel <-
ACScommute %>% gather(
B08406_001E,
B08406_001M,
B08406_002E,
B08406_002M,
B08406_008E,
B08406_008M,
B08406_014E,
B08406_014M,
B08406_015E,
B08406_015M,
B08406_016E,
B08406_016M,
B08406_017E,
B08406_017M,
key = variable,
value = value
) %>%
mutate(metric = factor(stringr::str_sub(variable,-1,-1)),
variable = factor(stringr::str_sub(variable, 1,-2))) %>%
spread(key = metric, value = value) %>%
mutate(E = as.numeric(E),
M = as.numeric(M))  %>%
mutate(lower95CI = E - (1.96 / 1.645 * M),
upper95CI = E + (1.96 / 1.645 * M)) %>%
left_join(xwk) %>%
group_by(name, state, county, varName) %>%
summarize(
estimate = sum(E, na.rm = T),
lower95CI = sum(lower95CI, na.rm = T),
upper95CI = sum(upper95CI, na.rm = T)
)
return(CNTYtravel)
}
DaneTravel <- getCountyMeansTravel(state = 55,county = 025)
View(DaneTravel)
ACScommute <-
as.data.frame(fromJSON(
paste0(
"https://api.census.gov/data/2015/acs5?get=NAME,",
varString,
"&for=county:",
county,
"&in=state:",
state,
"&key=f78d6b6c18608edc379b5a06c55407ceb45e7038"
)
))
ACScommute <- ACScommute[-1, ]
colnames(ACScommute) <-
c(
"name",
"personsE",
"personsM",
"carTruckVanE",
"carTruckVanM",
"publicTransportE",
"publicTransportM",
"bicycleE",
"bicycleM",
"walkE",
"walkM",
"taxiMotoE",
"taxiMotoM",
"workHomeE",
"workHomeM",
"state",
"county"
)
xwk <-
data.frame(
variable = c(
"persons",
"carTruckVan",
"publicTransport",
"bicycle",
"walk",
"taxiMoto",
"workHome"
),
varName = c(
"workers",
"drive",
"transit",
"bicycle",
"walk",
"other",
"other"
)
)
View(ACScommute)
varString
ACScommute <-
as.data.frame(fromJSON(
paste0(
"https://api.census.gov/data/2015/acs5?get=NAME,",
varStringTOTAL,
"&for=county:",
county,
"&in=state:",
state,
"&key=f78d6b6c18608edc379b5a06c55407ceb45e7038"
)
))
ACScommute <- ACScommute[-1, ]
colnames(ACScommute) <-
c(
"name",
"personsE",
"personsM",
"carTruckVanE",
"carTruckVanM",
"publicTransportE",
"publicTransportM",
"bicycleE",
"bicycleM",
"walkE",
"walkM",
"taxiMotoE",
"taxiMotoM",
"workHomeE",
"workHomeM",
"state",
"county"
)
xwk <-
data.frame(
variable = c(
"persons",
"carTruckVan",
"publicTransport",
"bicycle",
"walk",
"taxiMoto",
"workHome"
),
varName = c(
"workers",
"drive",
"transit",
"bicycle",
"walk",
"other",
"other"
)
)
CNTYtravel <-
ACScommute %>% gather(
personsE,
personsM,
carTruckVanE,
carTruckVanM,
publicTransportE,
publicTransportM,
bicycleE,
bicycleM,
walkE,
walkM,
taxiMotoE,
taxiMotoM,
workHomeE,
workHomeM,
key = variable,
value = value
) %>%
mutate(metric = factor(stringr::str_sub(variable,-1,-1)),
variable = factor(stringr::str_sub(variable, 1,-2))) %>%
spread(key = metric, value = value) %>%
mutate(E = as.numeric(E),
M = as.numeric(M))  %>%
mutate(lower95CI = E - (1.96 / 1.645 * M),
upper95CI = E + (1.96 / 1.645 * M)) %>%
left_join(xwk) %>%
group_by(name, state, county, varName) %>%
summarize(
estimate = sum(E, na.rm = T),
lower95CI = sum(lower95CI, na.rm = T),
upper95CI = sum(upper95CI, na.rm = T)
)
varString <- varStringTOTAL
# https://api.census.gov/data/2015/acs5?get=NAME,B01001_001E&for=county:013&in=state:02
ACScommute <-
as.data.frame(fromJSON(
paste0(
"https://api.census.gov/data/2015/acs5?get=NAME,",
varString,
"&for=county:",
county,
"&in=state:",
state,
"&key=f78d6b6c18608edc379b5a06c55407ceb45e7038"
)
))
ACScommute <- ACScommute[-1, ]
colnames(ACScommute) <-
c(
"name",
"personsE",
"personsM",
"carTruckVanE",
"carTruckVanM",
"publicTransportE",
"publicTransportM",
"bicycleE",
"bicycleM",
"walkE",
"walkM",
"taxiMotoE",
"taxiMotoM",
"workHomeE",
"workHomeM",
"state",
"county"
)
xwk <-
data.frame(
variable = c(
"persons",
"carTruckVan",
"publicTransport",
"bicycle",
"walk",
"taxiMoto",
"workHome"
),
varName = c(
"workers",
"drive",
"transit",
"bicycle",
"walk",
"other",
"other"
)
)
View(ACScommute)
singleSex <- function(varString, sex) {
# https://api.census.gov/data/2015/acs5?get=NAME,B01001_001E&for=county:013&in=state:02
ACScommute <-
as.data.frame(fromJSON(
paste0(
"https://api.census.gov/data/2015/acs5?get=NAME,",
varString,
"&for=county:",
county,
"&in=state:",
state,
"&key=f78d6b6c18608edc379b5a06c55407ceb45e7038"
)
))
ACScommute <- ACScommute[-1, ]
colnames(ACScommute) <-
c(
"name",
"personsE",
"personsM",
"carTruckVanE",
"carTruckVanM",
"publicTransportE",
"publicTransportM",
"bicycleE",
"bicycleM",
"walkE",
"walkM",
"taxiMotoE",
"taxiMotoM",
"workHomeE",
"workHomeM",
"state",
"county"
)
# https://api.census.gov/data/2015/acs5?get=NAME,B01001_001E&for=county:013&in=state:02
ACScommute <-
as.data.frame(fromJSON(
paste0(
"https://api.census.gov/data/2015/acs5?get=NAME,",
varString,
"&for=county:",
county,
"&in=state:",
state,
"&key=f78d6b6c18608edc379b5a06c55407ceb45e7038"
)
))
ACScommute <- ACScommute[-1, ]
colnames(ACScommute) <-
c(
"name",
"personsE",
"personsM",
"carTruckVanE",
"carTruckVanM",
"publicTransportE",
"publicTransportM",
"bicycleE",
"bicycleM",
"walkE",
"walkM",
"taxiMotoE",
"taxiMotoM",
"workHomeE",
"workHomeM",
"state",
"county"
)
View(ACScommute)
